<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Set the character encoding and viewport for responsive design -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- The title of the page that appears in the browser tab -->
  <title>Interactive MAE Visualization</title>
  
  <!-- Include Plotly.js library from a CDN for creating interactive plots -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  
  <!-- CSS styles for the page -->
  <style>
    /* Style for equation and MAE display */
    .equation {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    /* Grouping controls together with some spacing */
    .control-group {
      margin-bottom: 10px;
    }
    /* Each label in a control group is displayed as a block element */
    .control-group label {
      display: block;
      margin-bottom: 5px;
    }
    /* Style for range and number inputs to line them up nicely */
    .control-group input[type="range"],
    .control-group input[type="number"] {
      vertical-align: middle;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <!-- Main heading for the visualization page -->
  <h2>Linear and Quadratic Fit with MAE Calculation</h2>
  
  <!-- Linear Model Controls Section -->
  <h3>Linear Model Controls</h3>
  <div class="control-group">
    <!-- Control for B0 parameter in the linear model -->
    <label>
      B0:
      <!-- Slider input for B0 -->
      <input type="range" id="B0_linear" min="-100" max="400" step="10" value="20" oninput="syncValue('B0_linear','slider')" />
      <!-- Number input for B0 (allows precise value entry) -->
      <input type="number" id="B0_linear_num" min="-100" max="400" step="10" value="20" oninput="syncValue('B0_linear','number')" />
      <!-- Span element to display the current value of B0 -->
      <span id="B0_linear_value">20</span>
    </label>
    <!-- Control for B1 parameter in the linear model -->
    <label>
      B1:
      <!-- Slider input for B1 -->
      <input type="range" id="B1_linear" min="-0.1" max="1.1" step="0.1" value="0.5" oninput="syncValue('B1_linear','slider')" />
      <!-- Number input for B1 -->
      <input type="number" id="B1_linear_num" min="-0.1" max="1.1" step="0.1" value="0.5" oninput="syncValue('B1_linear','number')" />
      <!-- Span element to display the current value of B1 -->
      <span id="B1_linear_value">0.5</span>
    </label>
  </div>
  
  <!-- Display area for the linear model equation and its MAE -->
  <p id="equation_linear" class="equation"></p>
  <p id="mae_linear" class="equation"></p>
  <!-- Container for the linear model plot -->
  <div id="linearPlot"></div>
  
  <!-- Quadratic Model Controls Section -->
  <h3>Quadratic Model Controls</h3>
  <div class="control-group">
    <!-- Control for B0 parameter in the quadratic model -->
    <label>
      B0:
      <!-- Slider input for B0 -->
      <input type="range" id="B0_quadratic" min="-100" max="400" step="10" value="20" oninput="syncValue('B0_quadratic','slider')" />
      <!-- Number input for B0 -->
      <input type="number" id="B0_quadratic_num" min="-100" max="400" step="10" value="20" oninput="syncValue('B0_quadratic','number')" />
      <!-- Span element to display the current value of B0 -->
      <span id="B0_quadratic_value">20</span>
    </label>
    <!-- Control for B1 parameter in the quadratic model -->
    <label>
      B1:
      <!-- Slider input for B1 -->
      <input type="range" id="B1_quadratic" min="-0.1" max="1.1" step="0.1" value="0.5" oninput="syncValue('B1_quadratic','slider')" />
      <!-- Number input for B1 -->
      <input type="number" id="B1_quadratic_num" min="-0.1" max="1.1" step="0.1" value="0.5" oninput="syncValue('B1_quadratic','number')" />
      <!-- Span element to display the current value of B1 -->
      <span id="B1_quadratic_value">0.5</span>
    </label>
    <!-- Control for B2 parameter in the quadratic model -->
    <label>
      B2:
      <!-- Slider input for B2 -->
      <input type="range" id="B2_quadratic" min="-0.0005" max="0.0005" step="0.00005" value="0.0001" oninput="syncValue('B2_quadratic','slider')" />
      <!-- Number input for B2 -->
      <input type="number" id="B2_quadratic_num" min="-0.0005" max="0.0005" step="0.00005" value="0.0001" oninput="syncValue('B2_quadratic','number')" />
      <!-- Span element to display the current value of B2 -->
      <span id="B2_quadratic_value">0.0001</span>
    </label>
  </div>
  
  <!-- Display area for the quadratic model equation and its MAE -->
  <p id="equation_quadratic" class="equation"></p>
  <p id="mae_quadratic" class="equation"></p>
  <!-- Container for the quadratic model plot -->
  <div id="quadraticPlot"></div>
  
  <!-- JavaScript Section -->
  <script>
    // ================================================================
    // FUNCTION: syncValue
    // ================================================================
    // This function synchronizes the slider and number input values for a given parameter.
    // - 'prefix' is the base identifier (e.g., "B0_linear").
    // - 'source' indicates if the update came from the slider ("slider") or the number input ("number").
    function syncValue(prefix, source) {
      // Get the slider element by its id.
      const slider = document.getElementById(prefix);
      // Get the corresponding number input element (with _num appended to the id).
      const number = document.getElementById(prefix + "_num");
      
      // Update the other input based on which one triggered the event.
      if (source === "slider") {
        number.value = slider.value;
      } else {
        slider.value = number.value;
      }
      
      // Update the display span with the current value.
      document.getElementById(prefix + "_value").textContent = slider.value;
      
      // Redraw the plots with the new values.
      updatePlot();
    }
    
    // ================================================================
    // FUNCTION: generateData
    // ================================================================
    // This function generates a simulated dataset of 30 random data points.
    // It returns an object containing two arrays: x (independent variable) and y (dependent variable).
    function generateData() {
      let x = [];
      let y = [];
      for (let i = 0; i < 30; i++) {
        // Generate a random x value between 0 and 2000.
        let x_val = Math.random() * 2000;
        // Create a noise value to simulate real-world variability.
        let noise = (Math.random() - 0.5) * 200;
        // Calculate y using a quadratic relationship with noise.
        let y_val = 100 + 0.75 * x_val - 0.0002 * Math.pow(x_val, 2) + noise;
        x.push(x_val);
        y.push(y_val);
      }
      return { x, y };
    }
    
    // Generate the dataset once when the page loads.
    let data = generateData();
    // Calculate the y-axis minimum and maximum based on the data (with some padding).
    let yMin = Math.min(...data.y) - 5;
    let yMax = Math.max(...data.y) + 5;
    
    // ================================================================
    // FUNCTION: updatePlot
    // ================================================================
    // This function:
    // - Reads the current parameter values.
    // - Updates the equation and MAE displays.
    // - Calculates the fitted lines for the linear and quadratic models.
    // - Redraws the plots using Plotly.
    function updatePlot() {
      // Retrieve current values for the linear model parameters.
      let B0_linear = parseFloat(document.getElementById("B0_linear").value);
      let B1_linear = parseFloat(document.getElementById("B1_linear").value);
      
      // Retrieve current values for the quadratic model parameters.
      let B0_quadratic = parseFloat(document.getElementById("B0_quadratic").value);
      let B1_quadratic = parseFloat(document.getElementById("B1_quadratic").value);
      let B2_quadratic = parseFloat(document.getElementById("B2_quadratic").value);
    
      // Create an array of x values for plotting the fitted lines.
      // This creates 100 points evenly spaced (0, 20, 40, ..., 1980).
      let xFit = Array.from({ length: 100 }, (_, i) => i * 20);
      
      // Calculate y values for the linear fit based on the equation: y = B0 + B1*x.
      let yLinear = xFit.map(x => B0_linear + B1_linear * x);
      // Calculate y values for the quadratic fit based on the equation: y = B0 + B1*x + B2*x^2.
      let yQuadratic = xFit.map(x => B0_quadratic + B1_quadratic * x + B2_quadratic * Math.pow(x, 2));
      
      // Define the layout for the plots, including axis labels, no grid lines, and spike line configuration.
      let layout = {
        xaxis: {
          title: "Search Ad Spending", // Label for x-axis.
          showgrid: false,             // Remove background grid lines.
          spikemode: 'toaxis',         // Spike lines extend to the x-axis when hovered.
          spikesnap: 'cursor',         // Spike lines snap to the cursor position.
          spikecolor: 'black',         // Spike lines color.
          spikethickness: 1            // Spike lines thickness.
        },
        yaxis: {
          title: "Revenue",            // Label for y-axis.
          range: [yMin, yMax],         // Set y-axis limits.
          showgrid: false,             // Remove background grid lines.
          spikemode: 'toaxis',         // Spike lines extend to the y-axis when hovered.
          spikesnap: 'cursor',         // Spike lines snap to the cursor position.
          spikecolor: 'black',         // Spike lines color.
          spikethickness: 1            // Spike lines thickness.
        },
        hovermode: 'closest'           // Spike lines only appear when directly hovering over a point.
      };
      
      // -------------------------------
      // Plotting the Linear Model
      // -------------------------------
      Plotly.newPlot('linearPlot', [
        // Plot actual data points as blue markers.
        { x: data.x, y: data.y, mode: 'markers', type: 'scatter', name: 'Actual Data', marker: { color: 'blue' } },
        // Plot the linear fitted line in red.
        { x: xFit, y: yLinear, mode: 'lines', type: 'scatter', name: 'Linear Fit', line: { color: 'red' } }
      ], { ...layout, title: 'Linear Fit' });
      
      // Update the displayed linear equation.
      document.getElementById("equation_linear").innerHTML =
        `REVENUE = ${B0_linear.toFixed(3)} + ${B1_linear.toFixed(3)} * Search_Ad_Spending`;
      
      // Calculate the Mean Absolute Error (MAE) for the linear model.
      let maeLinear = data.x.reduce((sum, x, i) => {
        return sum + Math.abs(data.y[i] - (B0_linear + B1_linear * x));
      }, 0) / data.x.length;
      
      // Display the MAE for the linear model.
      document.getElementById("mae_linear").textContent = "MAE (Linear): " + maeLinear.toFixed(3);
      
      // -------------------------------
      // Plotting the Quadratic Model
      // -------------------------------
      Plotly.newPlot('quadraticPlot', [
        // Plot actual data points as blue markers.
        { x: data.x, y: data.y, mode: 'markers', type: 'scatter', name: 'Actual Data', marker: { color: 'blue' } },
        // Plot the quadratic fitted line in red.
        { x: xFit, y: yQuadratic, mode: 'lines', type: 'scatter', name: 'Quadratic Fit', line: { color: 'red' } }
      ], { ...layout, title: 'Quadratic Fit' });
      
      // Update the displayed quadratic equation.
      document.getElementById("equation_quadratic").innerHTML =
        `REVENUE = ${B0_quadratic.toFixed(3)} + ${B1_quadratic.toFixed(3)} * Search_Ad_Spending + ${B2_quadratic.toFixed(4)} * Search_Ad_Spending²`;
      
      // Calculate the MAE for the quadratic model.
      let maeQuadratic = data.x.reduce((sum, x, i) => {
        return sum + Math.abs(data.y[i] - (B0_quadratic + B1_quadratic * x + B2_quadratic * Math.pow(x, 2)));
      }, 0) / data.x.length;
      
      // Display the MAE for the quadratic model.
      document.getElementById("mae_quadratic").textContent = "MAE (Quadratic): " + maeQuadratic.toFixed(3);
    }
    
    // Call updatePlot when the page loads to initialize the charts.
    updatePlot();
  </script>
</body>
</html>
